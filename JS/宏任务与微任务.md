<!-- å®ä»»åŠ¡ä¸Žå¾®ä»»åŠ¡.md -->
## å®ä»»åŠ¡ä¸Žå¾®ä»»åŠ¡
### å®šä¹‰
äº‹ä»¶å¾ªçŽ¯å¯ä»¥æœ‰å¤šä¸ªä»»åŠ¡é˜Ÿåˆ—ã€‚
åœ¨åº•å±‚æ¥çœ‹ï¼ŒJavaScriptä¸­æœ‰å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ã€‚
ä¸»è¦åŒºåˆ«åœ¨äºŽæ‰§è¡Œæ–¹å¼ã€‚å®ä»»åŠ¡åœ¨å•ä¸ªå¾ªçŽ¯å‘¨æœŸä¸­ä¸€æ¬¡ä¸€ä¸ªåœ°æŽ¨å…¥å †æ ˆï¼Œä½†å¾®ä»»åŠ¡æ€»æ˜¯åœ¨æ‰§è¡ŒåŽè¿”å›žåˆ°äº‹ä»¶å¾ªçŽ¯ä¹‹å‰æ¸…ç©ºã€‚åªæœ‰å½“å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œäº‹ä»¶å¾ªçŽ¯æ‰ä¼šé‡æ–°æ¸²æŸ“é¡µé¢ã€‚
äº‹ä»¶å¾ªçŽ¯çš„é¡ºåºï¼Œå†³å®šjsä»£ç çš„æ‰§è¡Œé¡ºåºã€‚è¿›å…¥æ•´ä½“ä»£ç (å®ä»»åŠ¡)åŽï¼Œå¼€å§‹ç¬¬ä¸€æ¬¡å¾ªçŽ¯ã€‚æŽ¥ç€æ‰§è¡Œæ‰€æœ‰çš„å¾®ä»»åŠ¡ã€‚ç„¶åŽå†æ¬¡ä»Žå®ä»»åŠ¡å¼€å§‹ï¼Œæ‰¾åˆ°å…¶ä¸­ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œå®Œæ¯•ï¼Œå†æ‰§è¡Œæ‰€æœ‰çš„å¾®ä»»åŠ¡ã€‚
macro-task(å®ä»»åŠ¡)ï¼šåŒ…æ‹¬æ•´ä½“ä»£ç scriptï¼ŒsetTimeoutï¼ŒsetInterval
micro-task(å¾®ä»»åŠ¡)ï¼šPromiseï¼Œprocess.nextTickï¼ˆåœ¨äº‹ä»¶å¾ªçŽ¯çš„ä¸‹ä¸€æ¬¡å¾ªçŽ¯ä¸­è°ƒç”¨ callback å›žè°ƒå‡½æ•°ï¼‰

![image](https://github.com/AddJunZ/Front-End/blob/master/img/eventloop.png)
![image](https://github.com/AddJunZ/Front-End/blob/master/img/eventloop-detail.png)


#### ä¾‹1
```js
console.log('1');

setTimeout(function() {
  console.log('2');
  process.nextTick(function() {
    console.log('3');
  })
  new Promise(function(resolve) {
    console.log('4');
    resolve();
  }).then(function() {
    console.log('5')
  })
})
process.nextTick(function() {
  console.log('6');
})
new Promise(function(resolve) {
  console.log('7');
  resolve();
}).then(function() {
  console.log('8')
})

setTimeout(function() {
  console.log('9');
  process.nextTick(function() {
    console.log('10');
  })
  new Promise(function(resolve) {
    console.log('11');
    resolve();
  }).then(function() {
    console.log('12')
  })
})
// answer 1 7 6 8 2 4 3 5 9 11 10 12
```
å¯¹ä¸Šé¢çš„æ•´ä¸ªè¿‡ç¨‹è¿›è¡Œåˆ†æžï¼š

1. é¦–å…ˆè¿›å…¥scriptæ ‡ç­¾çš„å®ä»»åŠ¡ä¸­ï¼Œè¾“å‡º```1```
2. æ‰§è¡Œ```setTimeout```æ³¨å†Œæ–°çš„å®ä»»åŠ¡(macro1)å¹¶æ”¾åœ¨å®ä»»åŠ¡é˜Ÿåˆ—ä¸­
3. æ‰§è¡Œ```process.nextTick```æ³¨å†Œæ–°çš„å¾®ä»»åŠ¡(micro1)å¹¶æ”¾åœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­
4. æ‰§è¡Œ```new Promise```è¾“å‡º```7```ï¼Œ```then```åŽçš„å‡½æ•°æ³¨å†Œä¸ºå¾®ä»»åŠ¡(micro2)æ”¾åœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­
5. æ‰§è¡Œ```setTimeout```æ³¨å†Œæ–°çš„å®ä»»åŠ¡(macro2)å¹¶æ”¾åœ¨å®ä»»åŠ¡é˜Ÿåˆ—ä¸­
6. å¤§çš„å®ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼ŒæŽ¥ç€æ‰§è¡Œè¯¥å®ä»»åŠ¡ä¸‹çš„å¾®ä»»åŠ¡é˜Ÿåˆ—
7. é¡ºåºæ‰§è¡Œmicro1å’Œmicro2ï¼Œåˆ†åˆ«è¾“å‡º```6```ï¼Œ```8```
8. ç¬¬ä¸€æ¬¡å¾ªçŽ¯ç»“æŸ

1. æ‰§è¡Œå®ä»»åŠ¡macro1ï¼Œè¾“å‡º```2```
2. æ‰§è¡Œ```process.nextTick```æ³¨å†Œæ–°çš„å¾®ä»»åŠ¡(micro3)å¹¶æ”¾åœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­
3. æ‰§è¡Œ```new Promise```è¾“å‡º```4```ï¼Œ```then```åŽçš„å‡½æ•°æ³¨å†Œä¸ºå¾®ä»»åŠ¡(micro4)æ”¾åœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­
4. é¡ºåºæ‰§è¡Œmicro3å’Œmicro4ï¼Œåˆ†åˆ«è¾“å‡º```3```ï¼Œ```5```
5. ç¬¬äºŒæ¬¡å¾ªçŽ¯ç»“æŸ

1. æ‰§è¡Œå®ä»»åŠ¡macro1ï¼Œè¾“å‡º```9```
2. æ‰§è¡Œ```process.nextTick```æ³¨å†Œæ–°çš„å¾®ä»»åŠ¡(micro5)å¹¶æ”¾åœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­
3. æ‰§è¡Œ```new Promise```è¾“å‡º```11```ï¼Œ```then```åŽçš„å‡½æ•°æ³¨å†Œä¸ºå¾®ä»»åŠ¡(micro6)æ”¾åœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­
4. é¡ºåºæ‰§è¡Œmicro3å’Œmicro4ï¼Œåˆ†åˆ«è¾“å‡º```10```ï¼Œ```12```
5. ç¬¬ä¸‰æ¬¡å¾ªçŽ¯ç»“æŸ


#### ä¾‹2
```js
async function async1(){
	console.log('async1 start');
	await async2();
	console.log("async1 end");
}

async function async2(){
	console.log("async2");
}

console.log("script start");

setTimeout(function(){
	console.log("setTimeout")
}, 0)
async1()
new Promise(function(resolve){
	console.log('promise1')
	resolve()
}).then(function(){
	console.log("promise2")
})
console.log('script end')
```

```js
script start
async1 start
async2
promise1
script end
async1 end
promise2
setTimeout
```

å¯¹ä¸Šé¢çš„æ•´ä¸ªè¿‡ç¨‹è¿›è¡Œåˆ†æžï¼š

1. æ‰§è¡Œé¦–ä¸ªscriptæ ‡ç­¾çš„å®ä»»åŠ¡ï¼Œ è¾“å‡º```script start```
2. é‡åˆ°setTimeoutï¼Œä½œä¸ºå®ä»»åŠ¡æŒ‚èµ·
3. æ‰§è¡Œasync1å‡½æ•°ï¼Œè¾“å‡º```async1 start```ï¼Œè°ƒç”¨async2å‡½æ•°ï¼Œè¾“å‡º```async2```ï¼Œç”±äºŽasyncå‡½æ•°ä¸­awaitåŽé¢è¿”å›žçš„æ˜¯ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œæ‰€ä»¥awaitåŽè¾¹è°ƒç”¨çš„å†…å®¹å®žé™…ä¸Šç›¸å½“äºŽæ˜¯å†™åœ¨promiseçš„thenå‡½æ•°å†…éƒ¨ï¼Œå¦‚ä¸‹æ‰€ç¤º

```js
async function async1(){
	console.log('async1 start');
	await async2();
	console.log("async1 end");
}

// ç›¸å½“äºŽ ðŸ‘‡ðŸ‘‡

async function async1(){
	console.log('async1 start');
  async2().then(() => {
    console.log("async1 end");
  })
}
```

æ‰€ä»¥awaitåŽé¢çš„å†…å®¹å®žé™…ä¸Šæ˜¯ä»¥å¾®ä»»åŠ¡çš„å½¢å¼æŒ‚èµ·

4. æŽ¥ç€é‡åˆ°promiseï¼Œpromiseçš„å†…å®¹ä¼šç«‹å³æ‰§è¡Œï¼Œè¾“å‡º```promise1```ï¼ŒthenåŽé¢çš„å†…å®¹ä½œä¸ºå¾®ä»»åŠ¡æŒ‚èµ·
5. æœ€åŽè¾“å‡º```script end```ï¼Œç»“æŸç¬¬ä¸€ä¸ªå®ä»»åŠ¡ï¼ŒæŽ¥ç€æ‰§è¡Œå¾®ä»»åŠ¡ã€‚
6. é¦–å…ˆæ˜¯awaitåŽé¢æŒ‚èµ·çš„å¾®ä»»åŠ¡ï¼Œè¾“å‡º```async1 end```
7. æŽ¥ç€æ˜¯promiseæŒ‚èµ·çš„å¾®ä»»åŠ¡ï¼Œè¾“å‡º```promise2```
8. æ²¡æœ‰å¯¹åº”çš„å¾®ä»»åŠ¡äº†ï¼Œå°±æ‰§è¡ŒsetTimeoutå®ä»»åŠ¡ï¼Œè¾“å‡º```setTimeout```


#### ä¾‹3
```js
new Promise((resolve,reject)=>{
  resolve(1)
  console.log(2)
  Promise.resolve(3).then(res=>console.log(res))
  console.log(4)
}).then(res=>console.log(res))
```
```js
2
4
3
1
```

#### ä¾‹4ï¼šäº¤æ›¿æŽ¨å…¥å¾®ä»»åŠ¡æ ˆ
```js
new Promise((resolve, reject) => {
  console.log('1-1');
  resolve();
  new Promise((resolve, reject) => {
    console.log('2-1');
    resolve();
  }).then(() => {
    console.log('2-2');
  }).then(() => {
    console.log('2-3');
  }).then(() => {
    console.log('2-4');
  })
  console.log('3');
}).then(() => {
  console.log('1-2');
}).then(() => {
  console.log('1-3');
}).then(() => {
  console.log('1-4');
})
setTimeout(() => {
  console.log('4');
})
```

```js
1-1
2-1
3
2-2
1-2
2-3
1-3
2-4
1-4
4
```